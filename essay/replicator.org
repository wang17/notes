* replicator
** state transfer
state transfer分为两种，IST(incremental st)和SST(snapshot st), 第一种是增量状态传输，第二种是全量状态传输

*** when membership changes
state transfer触发时机是在membership发生变化的时候，replicator对应处理函数是process_conf_change. 这个处理函数是在GcsActionSource::dispatch里面调用的，而这个函数不断地从gcs取出action然后进行处理它。

#+BEGIN_SRC C++
    case GCS_ACT_CONF:
    {
        const gcs_act_conf_t* conf(static_cast<const gcs_act_conf_t*>(act.buf));
        wsrep_view_info_t* view_info( 
            galera_view_info_create(conf, conf->my_state == GCS_NODE_STATE_PRIM) // 构造view信息
            );
        replicator_.process_conf_change(recv_ctx, *view_info,
                                        conf->repl_proto_ver,
                                        state2repl(*conf), act.seqno_l); // 处理membership变化
        free(view_info);

        if (conf->conf_id < 0 && conf->memb_num == 0) { // 自己主动退出
            log_debug << "Received SELF-LEAVE. Closing connection.";
            // called after being shifted to S_CLOSING state.
            gcs_.close();
        }

        break;
    }
#+END_SRC

*** galera_view_info_create

